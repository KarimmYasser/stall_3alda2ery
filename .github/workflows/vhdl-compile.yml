name: VHDL Compile Check

on:
  push:
    branches: [main, master]
    paths:
      - "**.vhd"
      - ".github/workflows/vhdl-compile.yml"
  pull_request:
    branches: [main, master]
    paths:
      - "**.vhd"
      - ".github/workflows/vhdl-compile.yml"
  workflow_dispatch: # Allow manual trigger

jobs:
  compile:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install GHDL
        run: |
          sudo apt-get update
          sudo apt-get install -y ghdl

      - name: Check GHDL version
        run: ghdl --version

      - name: Make compile script executable
        run: chmod +x scripts/compile.sh

      - name: Compile all VHDL files
        run: |
          ./scripts/compile.sh . -r -s

      - name: Summary
        if: always()
        run: |
          echo "## VHDL Compile Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          if [ ${{ job.status }} == 'success' ]; then
            echo "✅ All VHDL files compiled successfully!" >> $GITHUB_STEP_SUMMARY
          else
            echo "❌ Some VHDL files failed to compile." >> $GITHUB_STEP_SUMMARY
          fi
